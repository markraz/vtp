<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>RoadMap.h Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body bgcolor="#ffffff">
<!-- Generated by Doxygen 1.2.9.1 -->
<center>
<a class="qindex" href="index.html">Main Page</a> &nbsp; <a class="qindex" href="hierarchy.html">Class Hierarchy</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; </center>
<hr><h1>RoadMap.h</h1><div class="fragment"><pre>00001 <font class="comment">//</font>
00002 <font class="comment">// RoadMap.h</font>
00003 <font class="comment">//</font>
00004 <font class="comment">// Copyright (c) 2001 Virtual Terrain Project</font>
00005 <font class="comment">// Free for all uses, see license.txt for details.</font>
00006 <font class="comment">//</font>
00007 
00008 <font class="preprocessor">#ifndef ROADMAPH</font>
00009 <font class="preprocessor"></font><font class="preprocessor">#define ROADMAPH</font>
00010 <font class="preprocessor"></font>
00011 <font class="preprocessor">#include "DLG.h"</font>
00012 
00013 <font class="preprocessor">#define RMFVERSION_STRING "RMFFile1.8"</font>
00014 <font class="preprocessor"></font><font class="preprocessor">#define RMFVERSION_CURRENT 1.8f</font>
00015 <font class="preprocessor"></font><font class="preprocessor">#define RMFVERSION_SUPPORTED 1.7f   // oldest supported version</font>
00016 <font class="preprocessor"></font>
00017 <font class="preprocessor">#define SWITCH 0</font>
00018 <font class="preprocessor"></font>
00019 <font class="keyword">enum</font> SurfaceType {
00020     ST_NONE,
00021     ST_GRAVEL,
00022     ST_TRAIL,
00023     ST_2TRACK,
00024     ST_DIRT,
00025     ST_PAVED,
00026     ST_RAILROAD
00027 };
00028 
00029 <font class="comment">//WARNING!!!! Do NOT change the order of the items in the enumeration.</font>
00030 <font class="keyword">enum</font> IntersectionType {
00031     IT_NONE,    <font class="comment">// uncontrolled</font>
00032     IT_LIGHT,   <font class="comment">// controlled intersection with at least one traffic light</font>
00033     IT_STOPSIGN,  <font class="comment">// controlled intersection with at least one stop sign</font>
00034 };
00035 
00036 <font class="keyword">enum</font> LightStatus {
00037     LT_INVALID,
00038     LT_RED,
00039     LT_YELLOW,
00040     LT_GREEN
00041 };
00042 
00043 <font class="comment">// road flags</font>
00044 <font class="preprocessor">#define RF_SIDEWALK 0x8000000</font>
00045 <font class="preprocessor"></font><font class="preprocessor">#define RF_PARKING  0x4000000</font>
00046 <font class="preprocessor"></font><font class="preprocessor">#define RF_MARGIN   0x2000000</font>
00047 <font class="preprocessor"></font><font class="preprocessor">#define RF_FORWARD  0x0800000   // true if traffic flows from node 0 to 1</font>
00048 <font class="preprocessor"></font><font class="preprocessor">#define RF_REVERSE  0x0400000   // true if traffic flows from node 1 to 0</font>
00049 <font class="preprocessor"></font><font class="comment">// the following are for temporary, runtime use</font>
00050 <font class="preprocessor">#define RF_HIT      0x0000001</font>
00051 <font class="preprocessor"></font>
00052 
00053 <font class="comment">//incomplete code for a node switch that tells which lanes connect to other</font>
00054 <font class="comment">//lanes on other roads.</font>
00055 <font class="preprocessor">#if SWITCH</font>
00056 <font class="preprocessor"></font><font class="comment">// Info in a node that directs traffic flow.</font>
00057 <font class="comment">// Tells which lanes can turn into which lanes.</font>
00058 <font class="keyword">class </font>LaneIO {
00059 <font class="keyword">public</font>:
00060     LaneIO();
00061     ~LaneIO();
00062     <font class="keywordtype">void</font> AddChoice(<font class="keyword">class</font> Road *road, <font class="keywordtype">int</font> lane);
00063     <font class="keywordtype">int</font> GetRoadNum(<font class="keyword">class</font> Road *road);
00064     <font class="comment">//number of choices to choose from reaching end of this lane</font>
00065     <font class="keywordtype">int</font> m_iChoices;
00066     <font class="comment">//possible roads</font>
00067     <font class="keyword">class </font>Road **m_pRoads;
00068     <font class="comment">//corresponding lane to road choice</font>
00069     <font class="keywordtype">int</font> *m_iLane;
00070 };
00071 
00072 <font class="keyword">class </font>RoadIO {
00073 <font class="keyword">public</font>:
00074     RoadIO(<font class="keywordtype">int</font> lanes);
00075     ~RoadIO();
00076     <font class="keywordtype">int</font> m_iLanes;
00077     LaneIO **m_pLaneIO;
00078 };
00079 
00080 <font class="keyword">class </font>Switch
00081 {
00082 <font class="keyword">public</font>:
00083     Switch(<font class="keywordtype">int</font> r, <font class="keyword">class</font> Road **roads);
00084     ~Switch();
00085     <font class="comment">//return possible road choices given current road and lane.</font>
00086     Road** RoadChoices(Road *curRoad, <font class="keywordtype">int</font> curLane);
00087     <font class="comment">//return possible lane to follow given destination road and current road and lane</font>
00088     <font class="keywordtype">int</font> LaneChoice(Road *curRoad, <font class="keywordtype">int</font> curLane, Road* destRoad);
00089     <font class="keywordtype">int</font> LaneChoice(Road *curRoad, <font class="keywordtype">int</font> curLane, <font class="keywordtype">int</font> destRoad);
00090 
00091     <font class="keywordtype">int</font> m_iRoads;
00092     <font class="comment">//roads</font>
00093     <font class="keyword">class </font>Road **m_pRoads;  <font class="comment">//points to node's roads</font>
00094     <font class="comment">//structure to hold lanes associated with the road</font>
00095     RoadIO **m_pRoadIO;
00096 };
00097 <font class="preprocessor">#endif //SWITCH</font>
00098 <font class="preprocessor"></font>
00099 <font class="comment">//</font>
00100 <font class="comment">// A place where 2 or more roads meet</font>
00101 <font class="comment">//</font>
00102 <font class="keyword">class </font>Node
00103 {
00104 <font class="keyword">public</font>:
00105     Node();
00106     ~Node();
00107 
00108     <font class="comment">// comparison</font>
00109     <font class="keywordtype">bool</font> operator==(Node &amp;ref);
00110 
00111     <font class="comment">//copies internal variables from given node.</font>
00112     <font class="keywordtype">void</font> Copy(Node* node);
00113 
00114     <font class="keyword">class </font>Road *GetRoad(int n);
00115     <font class="keywordtype">int</font> FindRoad(<font class="keywordtype">int</font> roadID);           <font class="comment">//returns internal number of road with given ID.  -1 if not found.</font>
00116     <font class="keywordtype">void</font> AddRoad(<font class="keyword">class</font> Road *pR);       <font class="comment">//adds a road to the node</font>
00117     <font class="keywordtype">void</font> DetachRoad(<font class="keyword">class</font> Road *pR);    <font class="comment">//detaches the road from the node.</font>
00118     <font class="keywordtype">double</font> DistanceToPoint(DPoint2 target);  <font class="comment">//distance from a point to the node</font>
00119     <font class="keywordtype">void</font> DetermineRoadAngles();         <font class="comment">//resulting angles &gt; 0</font>
00120     <font class="keywordtype">void</font> SortRoadsByAngle();            <font class="comment">//sorts the internal roads by angle.</font>
00121     DPoint2 find_adjacent_roadpoint2d(Road *pR);  <font class="comment">//returns the 2nd point on the road from the node.</font>
00122 
00123     <font class="comment">//sets intersection type for node.  returns false if road not found</font>
00124     <font class="keywordtype">bool</font> SetIntersectType(Road *road, IntersectionType type);
00125     <font class="keywordtype">bool</font> SetIntersectType(<font class="keywordtype">int</font> roadNum, IntersectionType type);  <font class="comment">//roadNum is internal index within the node</font>
00126     IntersectionType GetIntersectType(Road *road);  <font class="comment">//returns the intersection type of given road</font>
00127     IntersectionType GetIntersectType(<font class="keywordtype">int</font> roadNum); <font class="comment">//returns the intersection type of given road index (not ID)</font>
00128     LightStatus GetLightStatus(Road *road);         <font class="comment">//returns the light status of given road</font>
00129     LightStatus GetLightStatus(<font class="keywordtype">int</font> roadNum);        <font class="comment">//returns the light status of given road index (not ID)</font>
00130     <font class="keywordtype">bool</font> SetLightStatus(Road *road, LightStatus light); <font class="comment">//sets the light status of given road</font>
00131     <font class="keywordtype">bool</font> SetLightStatus(<font class="keywordtype">int</font> roadNum, LightStatus light); <font class="comment">//sets the light status of given road index (not ID)</font>
00132 
00133     <font class="keywordtype">bool</font> HasLights();
00134     <font class="keywordtype">bool</font> IsControlled();    <font class="comment">// true if any stopsigns or stoplights</font>
00135 
00136     <font class="comment">//adjust the light relationship of the roads at the node (if the intersection is has a signal light.)</font>
00137     <font class="keywordtype">void</font> AdjustForLights();
00138 
00139 <font class="preprocessor">#if SWITCH</font>
00140 <font class="preprocessor"></font>    <font class="keywordtype">void</font> SetupSwitch();
00141     <font class="comment">//i is index to current road</font>
00142     <font class="keywordtype">void</font> DetermineOptions(<font class="keywordtype">int</font> i, <font class="keywordtype">int</font> *in,
00143                         <font class="keywordtype">int</font> &amp;right, <font class="keywordtype">int</font> &amp;straight, <font class="keywordtype">int</font> &amp;left, <font class="keywordtype">int</font> &amp;uturn);
00144     Switch *m_pSwitch;
00145 <font class="preprocessor">#endif //SWITCH</font>
00146 <font class="preprocessor"></font>
00147     DPoint2 m_p;    <font class="comment">// utm coordinates of center</font>
00148     <font class="keywordtype">int</font> m_iRoads;   <font class="comment">// number of roads meeting here</font>
00149     <font class="keywordtype">int</font> m_id;       <font class="comment">// only used for reading from DLG/RMF</font>
00150 
00151     <font class="comment">// angle of each road, not initialized till SortRoadsByAngle is called</font>
00152     <font class="keywordtype">float</font> *m_fRoadAngle;
00153 
00154     Node *m_pNext;
00155 <font class="keyword">protected</font>:
00156     IntersectionType *m_IntersectTypes; <font class="comment">//intersection types of the roads at this node.</font>
00157     LightStatus *m_Lights;  <font class="comment">//lights of the roads at this node.</font>
00158     <font class="keyword">class </font>Road **m_r;  <font class="comment">//array of roads that intersect this node.</font>
00159 };
00160 
00161 
00162 <font class="comment">//</font>
00163 <font class="comment">// a series of points, connecting one node to another</font>
00164 <font class="comment">//</font>
00165 <font class="keyword">class </font>Road : <font class="keyword">public</font> DLine2
00166 {
00167 <font class="keyword">public</font>:
00168     Road();
00169     Road(Road &amp;ref);
00170     ~Road();
00171 
00172     <font class="comment">// comparison</font>
00173     <font class="keywordtype">bool</font> operator==(Road &amp;ref);
00174 
00175     <font class="keywordtype">void</font> SetNode(<font class="keywordtype">int</font> n, Node *pNode)<font class="keyword"> </font>{ m_pNode[n] = pNode; }
00176     Node *GetNode(<font class="keywordtype">int</font> n)<font class="keyword"> </font>{ <font class="keywordflow">return</font> m_pNode[n]; }
00177     <font class="comment">// closet distance from target to the road</font>
00178     <font class="keywordtype">double</font> DistanceToPoint(DPoint2 target);
00179     <font class="comment">// is the road a loop?</font>
00180     <font class="keywordtype">bool</font> IsLoop()<font class="keyword"> </font>{ <font class="keywordflow">return</font> (m_pNode[0] == m_pNode[1]); }
00181 
00182     <font class="keywordtype">void</font> SetFlag(<font class="keywordtype">int</font> flag, <font class="keywordtype">bool</font> value); <font class="comment">//value true, perform bitwise OR with flag.  otherwise, bitwise AND</font>
00183     <font class="keywordtype">bool</font> GetFlag(<font class="keywordtype">int</font> flag);
00184 
00185     <font class="keywordtype">float</font> GetHeightAt(<font class="keywordtype">int</font> i);   <font class="comment">//height at node (0 or 1).</font>
00186     <font class="keywordtype">float</font> GetHeightAt(Node *node);  <font class="comment">//height at node</font>
00187     <font class="keywordtype">void</font> SetHeightAt(<font class="keywordtype">int</font> i, <font class="keywordtype">float</font> height);  <font class="comment">//set the height at a node (0 or 1)</font>
00188     <font class="keywordtype">void</font> SetHeightAt(Node *node, <font class="keywordtype">float</font> height); <font class="comment">//set the height at a node</font>
00189     <font class="keywordtype">float</font> Length(); <font class="comment">//returns length of road.</font>
00190 
00191     <font class="keywordtype">float</font> m_fWidth;     <font class="comment">// road width in meters</font>
00192     <font class="keywordtype">int</font> m_iLanes;       <font class="comment">// number of lanes</font>
00193     SurfaceType m_Surface;
00194 
00195     <font class="keywordtype">int</font> m_iHwy;         <font class="comment">// highway number: -1 for normal roads</font>
00196 
00197     Road *m_pNext;      <font class="comment">// the next Road, if roads are maintained in list form</font>
00198 
00199     <font class="keywordtype">int</font> m_id;           <font class="comment">// only used for reading from DLG</font>
00200 
00201     <font class="keywordtype">unsigned</font> <font class="keywordtype">int</font> m_iFlags;  <font class="comment">// a flag to be used to holding any addition info.</font>
00202 
00203 <font class="keyword">protected</font>:
00204     Node *m_pNode[2];   <font class="comment">// "from" and "to" nodes</font>
00205 <font class="comment">//  IntersectionType m_iBehavior[2];</font>
00206     <font class="keywordtype">float</font> m_fHeight[2];
00207 };
00208 
00209 <font class="keyword">typedef</font> Road *RoadPtr;
00210 <font class="keyword">typedef</font> Node *NodePtr;
00211 
00212 <font class="preprocessor">#define intSize 4</font>
00213 <font class="preprocessor"></font><font class="preprocessor">#define floatSize 4</font>
00214 <font class="preprocessor"></font><font class="preprocessor">#define doubleSize 8</font>
00215 <font class="preprocessor"></font>
00216 <font class="keyword">class </font>vtRoadMap
00217 {
00218 <font class="keyword">public</font>:
00219     vtRoadMap();
00220     ~vtRoadMap();
00221 
00222     Node *FindNodeByID(<font class="keywordtype">int</font> id);
00223     <font class="keywordtype">void</font> DeleteElements();
00224     DRECT GetMapExtent();       <font class="comment">// get the geographical extent of the road map</font>
00225     <font class="keywordtype">void</font> ComputeExtents();
00226 
00227     <font class="keywordtype">int</font>     NumRoads() <font class="keyword">const</font>;   <font class="comment">// returns number of roads in the road map</font>
00228     <font class="keywordtype">int</font>     NumNodes() <font class="keyword">const</font>;   <font class="comment">// returns number of nodes in the road map</font>
00229 
00230     Road    *GetFirstRoad()<font class="keyword"> </font>{ <font class="keywordflow">return</font> m_pFirstRoad; }
00231     Node    *GetFirstNode()<font class="keyword"> </font>{ <font class="keywordflow">return</font> m_pFirstNode; }
00232 
00233     <font class="keyword">virtual</font> Node *NewNode()<font class="keyword"> </font>{ <font class="keywordflow">return</font> <font class="keyword">new</font> Node; }
00234     <font class="keyword">virtual</font> Road *NewRoad()<font class="keyword"> </font>{ <font class="keywordflow">return</font> <font class="keyword">new</font> Road; }
00235 
00236     <font class="keywordtype">void</font>    AddNode(Node *pNode)<font class="keyword"></font>
00237 <font class="keyword">    </font>{
00238         pNode-&gt;m_pNext = m_pFirstNode;
00239         m_pFirstNode = pNode;
00240     }
00241     <font class="keywordtype">void</font>    AddRoad(Road *pRoad)<font class="keyword"></font>
00242 <font class="keyword">    </font>{
00243         pRoad-&gt;m_pNext = m_pFirstRoad;
00244         m_pFirstRoad = pRoad;
00245     }
00246 
00247     <font class="comment">// cleaning function: remove unused nodes, return the number removed</font>
00248     <font class="keywordtype">int</font> RemoveUnusedNodes();
00249 
00250     <font class="keywordtype">bool</font> ReadRMF(<font class="keyword">const</font> <font class="keywordtype">char</font> *filename, <font class="keywordtype">bool</font> bHwy, <font class="keywordtype">bool</font> bPaved, <font class="keywordtype">bool</font> bDirt);
00251     <font class="keywordtype">bool</font> WriteRMF(<font class="keyword">const</font> <font class="keywordtype">char</font> *filename);
00252 
00253     <a class="code" href="classvtProjection.html">vtProjection</a> &amp;GetProjection()<font class="keyword"> </font>{ <font class="keywordflow">return</font> m_proj; }
00254 
00255 <font class="keyword">protected</font>:
00256     DRECT   m_extents;          <font class="comment">// the extent of the roads in the RoadMap</font>
00257     <font class="keywordtype">bool</font>    m_bValidExtents;    <font class="comment">// true when extents are computed</font>
00258 
00259     Road    *m_pFirstRoad;
00260     Node    *m_pFirstNode;
00261 
00262     <a class="code" href="classvtProjection.html">vtProjection</a>    m_proj;
00263 };
00264 
00265 <font class="preprocessor">#endif</font>
</font></pre></div><hr><address><small>Generated at Sun Oct 7 23:42:35 2001 for vtdata library by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.gif" alt="doxygen" align="middle" border=0 
width=110 height=53></a>1.2.9.1 written by <a href="mailto:dimitri@stack.nl">Dimitri van Heesch</a>,
 &copy;&nbsp;1997-2001</small></address>
</body>
</html>

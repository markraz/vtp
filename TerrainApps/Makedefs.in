########################################################################
#
# TerrainApps/Makedefs.in
#
# Copyright (c) 2002 Darren Erik Vengroff.  All rights reserved.
#
# $Id$
#
########################################################################

# This makefile contains definitions to build and install an executable.
# It knows how to read .dsp files to see what to build.

# Where to install, and to find other things that we may want to
# include/link with.

prefix 		= @prefix@
exec_prefix 	= @exec_prefix@
includedir 	= @includedir@
libdir  	= @libdir@
bindir  	= @bindir@


# Figure out what to build based on a .dsp file (Windows build project
# file) to stay in sync.

DSP_C_LINES	= $(shell grep "^SOURCE=.*\.c$$" $(DSP_FILE))
CFILES		= $(subst SOURCE=,,$(subst \,/,$(DSP_C_LINES)))

DSP_CXX_LINES	= $(shell grep "^SOURCE=.*\.cpp$$" $(DSP_FILE))
CXXFILES	= $(subst SOURCE=,,$(subst \,/,$(DSP_CXX_LINES)))

OBJS   		= $(CFILES:%.c=%.o) $(CXXFILES:%.cpp=%.o)

DEPFILES = $(CXXFILES:%.cpp=%.d) $(CFILES:%.c=%.d)

# Compiler info:

CC 	 = @CC@
CXX 	 = @CXX@

CFLAGS   = @CFLAGS@ @X_CFLAGS@
CXXFLAGS = @CXXFLAGS@ @X_CFLAGS@

# Linking:

LDLIBS =  -L$(libdir) @X_PRE_LIBS@ @X_LIBS@ @X_EXTRA_LIBS@ \
	  $(shell wx-config --libs) \
	  $(shell wx-config --gl-libs) \
	  -lXmu \
	  -lgdal.1.1 -lvtosg -lvtdata -lxmlhelper -lMini \
	  -losgDB -losgText -losgUtil -losg -lnetcdf \
	  -lGLU -lGL -lX11 -lXi -lm 

# Install info:

INSTALL = @INSTALL@

# We expect the makefile that includes us to define a target exe
# to install.

INSTALLED_EXE 	= $(bindir)/$(TARGET_EXE)

# How to compile it.  Mostly implicit.  GNU Make knows what to do to
# compile link the .o's..

MAKEDEPFLAGS = -MD

%.o %.d: %.c
	$(COMPILE.c) $(MAKEDEPFLAGS) -o $*.o $<

%.o %.d: %.cpp
	$(COMPILE.cc) $(MAKEDEPFLAGS) -o $*.o $<

all: $(TARGET_EXE)

$(TARGET_EXE): $(OBJS)
	$(LINK.cc) $^ $(LOADLIBES) $(LDLIBS) -o $@

# How to install:

install: $(INSTALLED_EXE)

$(INSTALLED_EXE): $(TARGET_EXE)
	$(INSTALL) -D $^ $@

# Make the depfiles.  Normally implicit.

depend: $(DEPFILES)

# How to clean up after ourselves:

clean:
	$(RM) $(OBJS) $(TARGET_EXE)

clobber: clean
	$(RM) $(DEPFILES)

uninstall:
	$(RM) $(INSTALLED_EXE)

# Mainly for debugging:

print_dsp_targets:
	@echo ".dsp Modules: " $(CXXFILES)


.PHONY: all install uninstall clean clobber depend print_dsp_targets 

# Include autogenerated depfiles

include $(DEPFILES)
